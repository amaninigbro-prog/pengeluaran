<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencatat Pengeluaran</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9fafb;
        }
        .transaction-item {
            transition: all 0.2s ease;
        }
        .transaction-item:hover {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Pencatat Pengeluaran</h1>
            <p class="text-gray-600">Kelola keuangan Anda dengan mudah</p>
        </div>

        <!-- Summary Card -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-800 mb-2 md:mb-0">Ringkasan Pengeluaran</h2>
                <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                    <select id="viewMode" class="border border-gray-300 rounded-md px-3 py-2 text-sm">
                        <option value="weekly">Mingguan</option>
                        <option value="monthly" selected>Bulanan</option>
                    </select>
                    <input type="date" id="selectedDate" class="border border-gray-300 rounded-md px-3 py-2 text-sm">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-blue-50 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-blue-600">Total Pengeluaran</p>
                            <p id="totalExpenses" class="text-2xl font-bold text-blue-800">Rp 0</p>
                        </div>
                        <i data-lucide="dollar-sign" class="w-8 h-8 text-blue-600"></i>
                    </div>
                </div>

                <div class="bg-green-50 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-green-600">Jumlah Transaksi</p>
                            <p id="totalTransactions" class="text-2xl font-bold text-green-800">0</p>
                        </div>
                        <i data-lucide="wallet" class="w-8 h-8 text-green-600"></i>
                    </div>
                </div>

                <div class="bg-purple-50 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-purple-600">Rata-rata per Transaksi</p>
                            <p id="averageTransaction" class="text-2xl font-bold text-purple-800">Rp 0</p>
                        </div>
                        <i data-lucide="trending-down" class="w-8 h-8 text-purple-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Transaction Form -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Tambah Transaksi Baru</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah (Rp)</label>
                    <input type="number" id="amount" placeholder="0" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Keterangan</label>
                    <input type="text" id="description" placeholder="Deskripsi transaksi" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                    <select id="category" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="Makanan">Makanan</option>
                        <option value="Transportasi">Transportasi</option>
                        <option value="Belanja">Belanja</option>
                        <option value="Hiburan">Hiburan</option>
                        <option value="Kesehatan">Kesehatan</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tipe Pembayaran</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center">
                            <input type="radio" name="type" value="cash" checked class="mr-2">
                            Cash
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="type" value="transfer" class="mr-2">
                            Transfer
                        </label>
                    </div>
                </div>
            </div>

            <button id="addTransactionBtn" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                Tambah Transaksi
            </button>
        </div>

        <!-- Transactions List -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Daftar Transaksi</h3>
            <div id="transactionsContainer"></div>
            <div id="categoryBreakdown" class="mt-6 hidden">
                <h4 class="font-semibold text-gray-800 mb-3">Breakdown per Kategori</h4>
                <div id="breakdownContent" class="space-y-2"></div>
            </div>
        </div>

        <!-- Data Info -->
        <div class="mt-4 text-center text-sm text-gray-500">
        </div>
    </div>

    <script>
        // Inisialisasi Lucide icons
        lucide.createIcons();

        // Data structure
        let transactions = [];

        // Load data from localStorage
        function loadTransactions() {
            const savedData = localStorage.getItem('expenseTransactions');
            if (savedData) {
                transactions = JSON.parse(savedData);
                updateUI();
            }
        }

        // Save data to localStorage
        function saveTransactions() {
            localStorage.setItem('expenseTransactions', JSON.stringify(transactions));
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Format date
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('id-ID', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        // Get filtered transactions based on view mode
        function getFilteredTransactions() {
            const viewMode = document.getElementById('viewMode').value;
            const selectedDate = new Date(document.getElementById('selectedDate').value);
            
            if (viewMode === 'weekly') {
                const startOfWeek = new Date(selectedDate);
                startOfWeek.setDate(selectedDate.getDate() - selectedDate.getDay());
                const endOfWeek = new Date(selectedDate);
                endOfWeek.setDate(selectedDate.getDate() + (6 - selectedDate.getDay()));
                
                return transactions.filter(t => {
                    const transactionDate = new Date(t.date);
                    return transactionDate >= startOfWeek && transactionDate <= endOfWeek;
                });
            } else {
                return transactions.filter(t => {
                    const transactionDate = new Date(t.date);
                    return transactionDate.getMonth() === selectedDate.getMonth() && 
                           transactionDate.getFullYear() === selectedDate.getFullYear();
                });
            }
        }

        // Update UI with current data
        function updateUI() {
            const filteredTransactions = getFilteredTransactions();
            const totalExpenses = filteredTransactions.reduce((total, t) => total + t.amount, 0);
            const transactionCount = filteredTransactions.length;
            const averageTransaction = transactionCount > 0 ? totalExpenses / transactionCount : 0;

            // Update summary cards
            document.getElementById('totalExpenses').textContent = formatCurrency(totalExpenses);
            document.getElementById('totalTransactions').textContent = transactionCount;
            document.getElementById('averageTransaction').textContent = formatCurrency(averageTransaction);

            // Update transactions list
            const transactionsContainer = document.getElementById('transactionsContainer');
            
            if (filteredTransactions.length === 0) {
                transactionsContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i data-lucide="calendar" class="w-12 h-12 mx-auto mb-4 text-gray-400"></i>
                        <p>Tidak ada transaksi untuk periode ini</p>
                    </div>
                `;
                document.getElementById('categoryBreakdown').classList.add('hidden');
            } else {
                transactionsContainer.innerHTML = filteredTransactions.map(transaction => `
                    <div class="transaction-item flex items-center justify-between p-4 border border-gray-200 rounded-lg mb-2">
                        <div class="flex items-center space-x-4">
                            <div class="w-3 h-3 rounded-full ${transaction.type === 'cash' ? 'bg-green-400' : 'bg-blue-400'}"></div>
                            <div>
                                <p class="font-medium text-gray-800">${transaction.description}</p>
                                <p class="text-sm text-gray-600">${transaction.category}</p>
                                <p class="text-xs text-gray-500">${formatDate(transaction.date)}</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <span class="text-red-600 font-semibold">${formatCurrency(transaction.amount)}</span>
                            <button onclick="deleteTransaction('${transaction.id}')" class="text-red-500 hover:text-red-700 transition-colors">
                                Hapus
                            </button>
                        </div>
                    </div>
                `).join('');

                // Update category breakdown
                const breakdown = {};
                filteredTransactions.forEach(t => {
                    breakdown[t.category] = (breakdown[t.category] || 0) + t.amount;
                });

                const breakdownContent = document.getElementById('breakdownContent');
                breakdownContent.innerHTML = Object.entries(breakdown).map(([category, amount]) => `
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-600">${category}</span>
                        <span class="text-red-600 font-medium">${formatCurrency(amount)}</span>
                    </div>
                `).join('');

                document.getElementById('categoryBreakdown').classList.remove('hidden');
            }

            // Update icons
            lucide.createIcons();
        }

        // Add new transaction
        function addTransaction() {
            const amount = parseFloat(document.getElementById('amount').value);
            const description = document.getElementById('description').value;
            const category = document.getElementById('category').value;
            const type = document.querySelector('input[name="type"]:checked').value;
            const date = document.getElementById('selectedDate').value;

            if (!amount || !description) {
                alert('Mohon isi jumlah dan keterangan transaksi');
                return;
            }

            const transaction = {
                id: Date.now().toString(),
                amount: amount,
                description: description,
                type: type,
                date: date,
                category: category
            };

            transactions.push(transaction);
            saveTransactions();
            updateUI();

            // Reset form
            document.getElementById('amount').value = '';
            document.getElementById('description').value = '';
        }

        // Delete transaction
        function deleteTransaction(id) {
            if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveTransactions();
                updateUI();
            }
        }

        // Event listeners
        document.getElementById('addTransactionBtn').addEventListener('click', addTransaction);
        document.getElementById('viewMode').addEventListener('change', updateUI);
        document.getElementById('selectedDate').addEventListener('change', updateUI);

        // Set default date to today
        document.getElementById('selectedDate').value = new Date().toISOString().split('T')[0];

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadTransactions();
        });
    </script>
</body>
</html>
